
games:
  get:
    by.gameId: >
      SELECT * FROM games WHERE id = :id
  insert: >
    INSERT INTO games (id, gameStatus) VALUES (:id, "IN_LOBBY")
  update:
    UPDATE games SET gameStatus = :gameStatus WHERE id = :id
  delete:

players:
  get:
    usernames: >
      SELECT username FROM players WHERE gameId = :id
    by.playerId: >
      SELECT * FROM players WHERE id = :id
    health: >
      SELECT health FROM players WHERE id = :id
  insert: >
    INSERT INTO players (id, gameId, username, health, isAdmin) VALUES (:id, :gameId, :username, :health, :isAdmin)
  update:
    health:
      UPDATE players SET health = health - :decrementBy WHERE id = :id;
  delete:

geoData:
  add.ping:
    INSERT INTO geoData (playerId, gameId, longitude, latitude, timeReceived) VALUES (:playerId, :gameId, :longitude, :latitude, :timeReceived)
  get:
    in.range: >
      SELECT g.playerId, g.gameId, g.longitude, g.latitude, g.timeReceived
      FROM geoData g
      INNER JOIN (
        SELECT playerId, MAX(timeReceived) as maxTimestamp
        FROM geoData
        WHERE gameId = :gameId AND playerId != :playerId AND timeReceived BETWEEN :min AND :max
        GROUP BY playerId
      ) t ON g.playerId = t.playerId AND g.timeReceived = t.maxTimestamp;
